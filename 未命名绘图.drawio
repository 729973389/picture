<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram name="压力检测流程图" id="pressure-detection-001">
    <mxGraphModel dx="1362" dy="754" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- 开始 -->
        <mxCell id="start" value="开始" style="ellipse;shape=ellipse;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="120" y="40" width="100" height="50" as="geometry"/>
        </mxCell>

        <!-- 获取数据 -->
        <mxCell id="fetch" value="获取最近5条原始数据" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="180" height="60" as="geometry"/>
        </mxCell>

        <!-- 判断数据是否足够 -->
        <mxCell id="check_data" value="数据是否足够？" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="110" y="230" width="120" height="60" as="geometry"/>
        </mxCell>

        <!-- 结束 -->
        <mxCell id="end" value="结束（等待下一次检测）" style="ellipse;shape=ellipse;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="330" width="180" height="60" as="geometry"/>
        </mxCell>

        <!-- 计算窗口均值 -->
        <mxCell id="calc_avg" value="计算滑动窗口均值 &amp; 当前值" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="360" y="130" width="220" height="60" as="geometry"/>
        </mxCell>

        <!-- 判断突变 -->
        <mxCell id="check_spike" value="当前值是否突然上升？（窗口内突变）" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="390" y="230" width="220" height="80" as="geometry"/>
        </mxCell>

        <!-- 异常处理 -->
        <mxCell id="abnormal" value="标记异常，写入日志" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="200" height="60" as="geometry"/>
        </mxCell>

        <!-- 正常/异常状态分支 -->
        <mxCell id="is_abnormal" value="是否处于异常状态？" style="rhombus;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#4a7ebb;" vertex="1" parent="1">
          <mxGeometry x="720" y="230" width="200" height="80" as="geometry"/>
        </mxCell>

        <!-- 正常逻辑：写日志 -->
        <mxCell id="normal" value="正常 → 写入日志" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="700" y="360" width="180" height="60" as="geometry"/>
        </mxCell>

        <!-- 异常逻辑：恢复检测 -->
        <mxCell id="check_recovery" value="取最近30条正常均值，判断恢复" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="960" y="360" width="240" height="60" as="geometry"/>
        </mxCell>

        <!-- 恢复判断 -->
        <mxCell id="recovery" value="是否连续3次恢复？" style="rhombus;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="980" y="470" width="200" height="60" as="geometry"/>
        </mxCell>

        <!-- 恢复成功 -->
        <mxCell id="recovered" value="恢复成功 → 写正常日志，结束异常" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="940" y="560" width="260" height="60" as="geometry"/>
        </mxCell>

        <!-- 持续异常 -->
        <mxCell id="still_abnormal" value="未恢复 → 记录持续异常日志" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1240" y="560" width="220" height="60" as="geometry"/>
        </mxCell>

        <!-- 连线 -->
        <mxCell id="edge1" edge="1" parent="1" source="start" target="fetch"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge2" edge="1" parent="1" source="fetch" target="check_data"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge3" edge="1" parent="1" source="check_data" target="end"><mxGeometry relative="1" as="geometry"><mxPoint x="160" y="400" as="targetPoint"/><mxPoint x="160" y="260" as="sourcePoint"/><mxPoint x="160" y="320" as="exitPoint"/><mxPoint x="160" y="370" as="entryPoint"/></mxGeometry></mxCell>
        <mxCell id="edge4" edge="1" parent="1" source="check_data" target="calc_avg"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge5" edge="1" parent="1" source="calc_avg" target="check_spike"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge6" edge="1" parent="1" source="check_spike" target="abnormal"><mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="500" y="310"/></Array></mxGeometry></mxCell>
        <mxCell id="edge7" edge="1" parent="1" source="check_spike" target="is_abnormal"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge8" edge="1" parent="1" source="is_abnormal" target="normal"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge9" edge="1" parent="1" source="is_abnormal" target="check_recovery"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge10" edge="1" parent="1" source="check_recovery" target="recovery"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge11" edge="1" parent="1" source="recovery" target="recovered"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="edge12" edge="1" parent="1" source="recovery" target="still_abnormal"><mxGeometry relative="1" as="geometry"/></mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
